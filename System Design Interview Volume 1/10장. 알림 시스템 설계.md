- 고객에게 중요할 만한 정보를 알림을 활용해 비동기적으로 제공
- 모바일 푸시 알림, SMS 메시지, 이메일로 분류 가능
## 문제 이해 및 설계 범위 확정
- 요구사항 분석
	- 알림 종류 지원 여부
	- 실시간성 보장 여부
	- 단말 지원 여부
	- 알림 생성 위치 확인
	- 옵트아웃 설정 가능 여부
	- 전송량
## 개략적 설계안 제시 및 동의 구하기
### 알림 유형별 지원 방안
#### iOS 푸시 알림
- 푸시 알림 지원을 위한 컴포넌트
	- **알림 제공자(provider)**: 알림 요청을 만들어 애플 푸시 알림 서비스(APNS)로 보내는 주체
		- 단말 토큰: 알림 요청 고유 식별자
		- 페이로드: 알림 내용 JSON
	- **APNS**: 애플 제공 원격 서비스로 푸시 알림을 iOS 장치로 보내는 역할
	- **iOS 단말**: 푸시 알림 수신 단말
#### 안드로이드 푸시 알림
- iOS 푸시 알림과 유사
	- APNS 대신 FCM 사용
#### SMS 메시지
- 제3사업자 서비스 이용
#### 이메일
- 고유 이메일 서버 구축 or 상용 이메일 서비스 이용
### 연락처 정보 수집 절차
- 알림 전송을 위한 정보
	- 모바일 단말 토큰, 전화번호, 이메일 주소 등...
- 앱 설치 후 계정 가입 시 해당 사용자 정보를 DB에 저장
### 알림 전송 및 수신 절차
#### 개략적 설계안 (초안)
![](https://velog.velcdn.com/images/haron/post/c3d6a47f-99e3-43ae-b688-c4ee728524d9/image.png)
	- **1부터 N까지의 서비스**: 마이크로서비스, 크론잡, 분산 시스템 컴포넌트 등 다양한 경우 존재
	- **알림 시스템**: 알림 전송/수신 처리의 핵심
		- 서비스에 알림 전송 API 제공
		- 제3자 서비스에 전달할 알림 페이로드 생성
	- **제3자 서비스**: 사용자에게 알림을 실제로 전달하는 역할
		- 확장성 고려 필요
		- 3자 서비스가 제공하는 범위 고려
	- **단말**: 사용자 단말
- 문제점
	- SPOF: 알림 시스템 장애 발생시 서비스 장애로 이어짐
	- 규모 확장성: DB나 캐시 규모 확장의 어려움
	- 성능 병목: 모든 것을 한 서버에서 처리 → 병목에 의한 시스템 과부하
#### 개략적 설계안 (개선된 버전)
![](https://velog.velcdn.com/images/haron/post/d26842ef-18af-4793-a87d-390fa38b0efd/image.png)
	- DB 및 캐시 분리
	- 알림 서버 증설 및 수평적 규모 확장 보장
	- MQ 활용 결합 감소
		- MQ: 시스템 컴포넌트 간 의존성 제거를 위해 사용 →  다량의 알림에 대한 버퍼 역할
		- 작업 서버: MQ 에서 전송할 알림을 꺼내 제3자 서비스로 전달하는 역할
## 상세 설계
### 안정성
#### 데이터 손실 방지
- 알림 전송 시스템의 가장 중요한 요구사항 → 어떤 상황에서도 알림이 소실되면 안됨
- 재시도 매커니즘의 구현 필요성
	- 알림 로그 DB 유지
#### 알림 중복 전송 방지
- 분산 시스템 특성상 가끔 [[You Cannot Have Exactly-Once Delivery - Brave New Geek|같은 알림 중복 전송 가능성]]
- 중복 탐지 메커니즘 도입을 통한 오류 처리
	- 이벤트 ID 검사를 통한 중복 처리
### 추가로 필요한 컴포넌트 및 고려사항
#### 알림 템플릿
- 비슷한 형식에 알림에 대한 템플릿 구현
#### 알림 설정
- 특정 종류의 알림에 대한 설정 제공
#### 전송률 제한
- 사용자가 받을 수 있는 알림 빈도 제한을 통한 피로도 감소
#### 재시도 방법
- 제3자 서비스에서 알림 전송에 실패한 경우 대비 → 재시도 전용 큐
#### 푸시 알림과 보안
- API 보안 유지를 위한 `appKey`, `appSecret` 활용
#### 큐 모니터링
- 큐에 쌓인 알림 갯수 고려 서버 확장
#### 이벤트 추적
- 알림 확인율, 클릭율, 실제 앱 사용 비율 정보 활용 데이터 분석
### 수정된 설계안
![](https://velog.velcdn.com/images/haron/post/83ceae6c-83d6-45a2-9ac5-4225a738d3e2/image.png)
	- 알림 서버에 인증 미치 전송률 제안 기능 추가
	- 재시도 기능 추가를 통한 전송 실패 대응
	- 전송 템플릿 활용 알림 생성 단순화 및 일관성 유지
	- 모니터링, 추적 시스템 추가를 통한 시스템 관리 및 개선 용이
## 마무리
- 안정성: 메시지 전송 실패율 감소를 위한 안정적인 재시도 메커니즘 도입
- 보안: 인증된 클라이언트만 알림 전송 가능
- 이벤트 추적 및 모니터링: 알림 전송 과정 추적 및 상태 모니터링
- 사용자 설정: 알림 수신 설정 조정 가능
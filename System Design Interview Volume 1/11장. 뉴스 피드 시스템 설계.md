- 지속적으로 업데이트되는 정보의 집합체
## 문제 이해 및 설계 범위 확정
- 요구사항 분석
	- 플랫폼 지원 여부
	- 주요 기능
	- 도메인 세부 정보
	- 트래픽 규모
	- 사용자 수
## 개략적 설계안 제시 및 동의 구하기
- 피드 발행: 사용자가 스토리 포스팅 시 해당 데이터를 캐시와 DB에 기록 → 친구 뉴스피드 전송
- 뉴스 피드 생성: 모든 친구 포스팅을 **시간 흐름 역순**으로 모아 생성
### 뉴스 피드 API
- 상태 정보 업데이트, 뉴스 피드 조회, 친구 추가 등에 사용
#### 피드 발행 API
- 새 스토리 포스팅 API
- HTTP `POST` 활용
#### 피드 읽기 API
- 뉴스 조회 API
- HTTP `GET` 활용
### 피드 발행
![](https://velog.velcdn.com/images/haron/post/766bd283-2495-47c5-a9e5-4c1998bd6540/image.png)
	- 포스팅 저장 서비스: 새 포스팅을 DB와 캐시에 저장
	- 포스팅 전송 서비스: 새 포스팅을 친구의 뉴스 피드에 push → 뉴스 피드 데이터는 캐시에 보관해 빠른 조회
### 뉴스 피드 생성
![](https://velog.velcdn.com/images/haron/post/5c500937-c494-43ec-8aab-00707ba4c277/image.png)
	- 뉴스 피드 서비스: 캐시에서 뉴스 피드를 가져오는 서비스
	- 뉴스 피드 캐시: 뉴스 피드 렌더링용 피드 ID 보관
## 상세 설계
### 피드 발행 흐름 상세 설계
#### 웹 서버
- 클라이언트 통신 뿐 아니라 인증이나 처리율 제한등의 기능도 수행
- Authorization 필요
- Spam 처리를 위한 방안 구현 필요
#### 포스팅 전송(팬아웃) 서비스
- 팬아웃: 어떤 사용자의 새 포스팅을 그 사용자와 친구 관계에 있는 모든 사용자에게 전달하는 과정
- 쓰기 시점 팬아웃 모델(Push)과 읽기 시점 팬아웃 모델(Poll)로 나뉨
- 쓰기 시점 팬아웃 모델:
	- 새로운 포스팅을 기록하는 시점에 뉴스피드 갱신 → 포스팅이 완료되는 순간 바로 해당 사용자에 캐시에 포스팅 기록
	- 장점:
		- 피드의 실시간 갱신 → 피드 조회 시간 감소
	- 단점:
		- 친구가 많은 경우 갱신 소요 시간 증가(핫 키)
		- 서비스를 자주 이용하지 않는 사용자의 피드까지 갱신해야 함 → 리소스 낭비
- 읽기 시점 팬아웃 모델:
	- 피드를 읽어야 하는 시점에 뉴스 피드 갱신(요청 기반 모델) → 사용자가 직접 로딩하는 시점에 새로운 포스트 조회
	- 장점:
		- 컴퓨팅 리소스를 효율적으로 사용
		- 데이터를 친구 각각에 푸시하는 작업 필요 X
	- 단점:
		- 뉴스 피드 조회 시간 증가
- 대부분의 사용자에는 **Push 모델**, 핫 키가 발생 할 수 있는 유명인의 경우 **Pull 모델** 적용
	- 요청과 데이터 분산을 고르게 할 수 있는 안정 해시를 사용해 핫 키 문제 감소
- 동작 방식
	1. **그래프 DB**에서 친구 ID 목록 조회
	2. 사용자 정보 캐시에서 친구 정보 조회
		- 설정 기반 친구 필터링 필요
	1. 메시지 큐에 친구 목록과 새 스토리의 포스팅 ID 적재
	2. 메시지 큐에서 데이터를 꺼내고 팬아웃 작업 서버가 뉴스 피드 데이터를 뉴스 피드 캐시에 추가
		- 캐시 크기 제한이나 ID 보관 등의 제약 필요
### 피드 읽기 흐름 상세 설계
![](https://velog.velcdn.com/images/haron/post/39824297-1d62-41d0-be91-0ae401947076/image.png)
	1. 피드 조회 API 호출
	2. 로드 밸런싱
	3. 뉴스 피드 서비스 호출
	4. 캐시에서 포스팅 ID 목록 조회
	5. ID 기반 사용자 캐시, 포스팅 캐시 조회 후 뉴스 피드 생성
	6. JSON 응답 반환
### 캐시 구조
![](https://velog.velcdn.com/images/haron/post/a8a78905-47fd-4625-9578-49e596ac6abc/image.png)
	- 뉴스 피드: 뉴스 피드 ID
	- 컨텐츠: 포스팅 데이터, 인기 컨텐츠 구분 필요
	- 소셜 그래프: 사용자 관계 정보
	- 행동: 포스팅에 대한 사용자 행위 / 좋아요, 답글 등등
	- 횟수: 좋아요 횟수, 응답 수, 팔로워 수 등...
## 마무리
- 추가로 논의하면 좋을 것
	- DB의 규모 확장
		- 수직적 vs 수평적
		- SQL vs NoSQL
		- master-slave 다중화
		- replica 읽기 연산
		- 일관성 모델
		- 샤딩
	- state-less web tier
	- 데이터 캐싱
	- 다중 DC 지원
	- MQ 기반 컴포넌트 결합도 낮추기
	- 핵심 메트릭 모니터링
